<!DOCTYPE html>
<html lang="en">

<head>

	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="description" content="">
	<meta name="author" content="">

	<title>Admin</title>

  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">

  <script type="text/javascript" src="https://code.jquery.com/jquery-3.5.1.js"></script>
  <script type="text/javascript" src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js"></script>
  <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.6.2/js/dataTables.buttons.min.js"></script>
  <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.6.2/js/buttons.flash.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
  <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.6.2/js/buttons.html5.min.js"></script>
  <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.6.2/js/buttons.print.min.js"></script>

  <link href="https://cdn.datatables.net/1.10.21/css/jquery.dataTables.min.css" rel="stylesheet">
  <link href="https://cdn.datatables.net/buttons/1.6.2/css/buttons.dataTables.min.css" rel="stylesheet">








  <link href="https://code.jquery.com/jquery-3.3.1.js" rel="stylesheet">
  <link href="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js" rel="stylesheet">
  <link href="https://cdn.datatables.net/select/1.3.1/js/dataTables.select.min.js" rel="stylesheet">
  <link href="https://cdn.datatables.net/1.10.20/css/jquery.dataTables.min.css" rel="stylesheet">

  <script type="text/javascript" src="https://code.jquery.com/jquery-3.3.1.js"></script>
  <script type="text/javascript" src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>
  <script type="text/javascript" src="https://cdn.datatables.net/select/1.3.1/js/dataTables.select.min.js"></script>
  <script type="text/javascript" src="https://cdn.datatables.net/1.10.20/css/jquery.dataTables.min.css"></script>



  <script type="text/javascript" src="https://code.jquery.com/jquery-3.5.1.js"></script>
  <script type="text/javascript" src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js"></script>
  <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.6.2/js/dataTables.buttons.min.js"></script>
  <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.6.2/js/buttons.flash.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
  <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.6.2/js/buttons.html5.min.js"></script>
  <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.6.2/js/buttons.print.min.js"></script>



  <link href="https://code.jquery.com/jquery-3.5.1.js" rel="stylesheet">
  <link href="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js" rel="stylesheet">
  <link href="https://cdn.datatables.net/buttons/1.6.2/js/dataTables.buttons.min.js" rel="stylesheet">
  <link href="https://cdn.datatables.net/buttons/1.6.2/js/buttons.flash.min.js" rel="stylesheet">

  <link href="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js" rel="stylesheet">
  <link href="https://cdn.datatables.net/buttons/1.6.2/js/buttons.html5.min.js" rel="stylesheet">
  <link href="https://cdn.datatables.net/buttons/1.6.2/js/buttons.print.min.js" rel="stylesheet">












</head>

<body>
  <br>
  
  <button type="button" class="btn btn-primary" id="btnBack">Back</button>
  <button type="button" class="btn btn-primary" id="btnSelectExport">Export Select</button>
  <br>

  <br>

  <table id="example" class="display nowrap" style="width:100%">
    <thead>
      <tr>
        <th>Name</th>
        <th>Segment Image</th>
        <th>Coin</th>
        <th>Segment Time</th>
        <th>Status</th>
        <th>Approve By</th>
        <th>Approve Time</th>
      </tr>
    </thead>
    <tbody>



    </tbody>
  </table>



  <script type="text/javascript">

    window.onload = function() {


      const queryString = window.location.search;
      const urlParams = new URLSearchParams(queryString);
      const user = urlParams.get('user');
      const type = urlParams.get('type');


      var ref5 = firebase.database().ref("user/"+user);
      ref5.once("value")
      .then(function(snapshot){

        var firstname_user = snapshot.child("firstname").val();
        var lastname_user = snapshot.child("lastname").val();
        document.title = firstname_user+"_"+lastname_user;


      });



      var t1 = $('#example').DataTable({
        dom: 'Bfrtip',
        buttons: [
        'copy', 'csv', 'excel', 'pdf', 'print'
        ]
      });




      var ref = firebase.database().ref('user/'+user+'/'+type+'/');
      ref.on('child_added', function(snapshot) { 

        var data = snapshot.val();
        var key1 = snapshot.key;


        var ref2 = firebase.database().ref("image/"+key1);
        ref2.once("value")
        .then(function(snapshot){
         var coin = snapshot.child("coin").val();


         var ref3 = firebase.database().ref("user/"+data.approveby);
         ref3.once("value")
         .then(function(snapshot){

           var firstname = snapshot.child("firstname").val();
           var lastname = snapshot.child("lastname").val();


           var ref4 = firebase.database().ref("user/"+user);
           ref4.once("value")
           .then(function(snapshot){

            var firstname_user = snapshot.child("firstname").val();
            var lastname_user = snapshot.child("lastname").val();

            t1.row.add( [
              firstname_user+" "+lastname_user,
              key1,
              coin,
              data.time,
              '<div class="status">'+data.status.toUpperCase()+'</div>',
              firstname+" "+lastname,
              data.approvetime

              ] ).draw( false );

          });

         });






       });
      });


    };




    $('#btnBack').click( function () {

      window.location.href = "admin.html";

    } );



    $(document).ready(function() {

      $('#example tbody').on( 'click', 'tr', function () {
        $(this).toggleClass('selected');
        if ($(this).find(".status").html() == 'APPROVE' && $(this).find(".redeem").html() == "NO") {
          $(this).toggleClass('selected');
        }
      } );

    });



    $('#btnSelectExport').click( function () {

      var table = $('#example').DataTable();

      const queryString = window.location.search;
      const urlParams = new URLSearchParams(queryString);
      const user = urlParams.get('user');
      const type = urlParams.get('type');

      sessionStorage.removeItem('list_export_image');

      var count = table.rows('.selected').data().length;

      console.log(count);

      var list_export_image = [];


      for (var i = 0; i < count; i++) {

        // console.log(table.rows('.selected').data()[i][1]);

        list_export_image.push(table.rows('.selected').data()[i][1]);

 
        sessionStorage.setItem("list_export_image", JSON.stringify(list_export_image));

        window.location.href = "admin_user_export_select.html?user="+user+"&type="+type;

      }

    } );




  </script>




  <script src="https://www.gstatic.com/firebasejs/7.11.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.11.0/firebase-analytics.js"></script>
  <script src="https://www.gstatic.com/firebasejs/5.4.2/firebase.js"></script>
  <script>
   var firebaseConfig = {
    apiKey: "AIzaSyBA8_iJYJUTB81W6y41kBbAFUhETKXdn38",
    authDomain: "labeljpn.firebaseapp.com",
    databaseURL: "https://labeljpn.firebaseio.com",
    projectId: "labeljpn",
    storageBucket: "labeljpn.appspot.com",
    messagingSenderId: "478979409533",
    appId: "1:478979409533:web:a286086924054873c6d314",
    measurementId: "G-74RV1SGSWC"
  };
  firebase.initializeApp(firebaseConfig);
</script>

</body>

</html>
